```{r}

require(deSolve)

seirmod = function(times, state, parms) {
  #Pull state variables from state vector
  S = state[1]
  E = state[2]
  I = state[3]
  R = state[4]
  N = S + E + I + R
  
  # beta - transmission coefficient
  # sigma - incubation period
  # gamma - recovery period
  # mu - mortality rate
  
  #Pull parameter values from parms vector
  beta = parms["beta"]
  sigma = parms["sigma"]
  gamma = parms["gamma"]
  mu = parms["mu"]
  
  #Define equations
  dS = -beta * S * I / N
  dE = (beta * S * I / N) - (sigma * E)
  dI = (sigma * E) - (gamma * I) - (mu * I)
  dR = gamma * I 
  dM = mu * I
  res = c(dS, dE, dI, dR, dM)
  #Return list of gradients
  list(res)
}

#### Zuiderdam ####
starts = c(S = 2688, E = 0, I = 14, R = 0, M = 0) #Based on the fact that Day 2 has 14 symptomatic in CDC report
times  = seq(1, 9, by = 1)
betas = 0.75 #0.75 for 2 days or 0.5 for 3 days
gammas = 0.5 #0.5 for 2 days or 0.33 for 3 days
sigmas = 2 #incubation period of 0.5 days
########

#### Diamond ####
#starts = c(S = 2701, E = 0, I = 1, R = 0, M = 0)
#times  = seq(1, 30, by = 1)
#betas = seq(0.18, 0.20, by = 0.01)
#betas = 1.35 #0.20
#sigmas = 0.20
#gammas = 0.091
########

df_list = list()
avg_frame = data.frame()

i = 1
for (beta_ in betas) {
  parms = c(beta =  beta_, sigma = sigmas, gamma = gammas, mu = 0)
  out = ode(y = starts, times = times, func = seirmod, parms = parms)
  out = as.data.frame(out)
  df_list[[i]] = out
  if(i == 1) {
    avg_frame = out 
  }
  else {
    avg_frame = avg_frame + out 
  }
  i = i + 1
}

n_frames = length(betas)
avg_frame = avg_frame / n_frames

summation = data.frame()
for(i in 1:n_frames) {
  filter_frame = data.frame(df_list[[i]])
  if (i == 1) {
    summation = (filter_frame - avg_frame) ^ 2
  }
  else {
    summation = summation + ((filter_frame - avg_frame) ^ 2)
  }
}

summation = summation / n_frames
summation = sqrt(summation)

tmp_frame = cbind(avg_frame, summation[ , c(2:6)])
colnames(tmp_frame) = c('DAY', 'S_AVG', 'E_AVG', 'I_AVG', 'R_AVG', 'M_AVG', 'S_STD', 'E_STD', 'I_STD', 'R_STD', 'M_STD')

output_folder = 'output_seir_shipX_2d.csv' #file with the raw output numbers

write.table(tmp_frame, output_folder, sep = ",", row.names = F, col.names = T, quote = F)
```


